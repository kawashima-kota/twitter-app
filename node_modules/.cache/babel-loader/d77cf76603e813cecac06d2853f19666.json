{"ast":null,"code":"import _slicedToArray from\"/Users/kawashimakouta/Desktop/react-projects/twitter-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Users/kawashimakouta/Desktop/react-projects/twitter-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/kawashimakouta/Desktop/react-projects/twitter-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useState}from\"react\";import styles from\"./Auth.module.css\";import{useDispatch}from\"react-redux\";import{updateUserProfile}from\"../features/userSlice\";import{auth,provider,storage}from\"../firebase/index\";import{Avatar,Button,CssBaseline,TextField,Paper,Grid,Typography,makeStyles,Modal,IconButton,Box}from\"@material-ui/core\";import SendIcon from\"@material-ui/icons/Send\";import CameraIcon from\"@material-ui/icons/Camera\";import EmailIcon from\"@material-ui/icons/Email\";import LockOutlinedIcon from\"@material-ui/icons/LockOutlined\";import AccountCircleIcon from\"@material-ui/icons/AccountCircle\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function getModalStyle(){var top=50;var left=50;return{top:\"\".concat(top,\"%\"),left:\"\".concat(left,\"%\"),transform:\"translate(-\".concat(top,\"%, -\").concat(left,\"%)\")};}var useStyles=makeStyles(function(theme){return{root:{height:\"100vh\"},image:{backgroundImage:\"url(https://images.unsplash.com/photo-1581784368651-8916092072cf?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=934&q=80)\",backgroundRepeat:\"no-repeat\",backgroundColor:theme.palette.type===\"light\"?theme.palette.grey[50]:theme.palette.grey[900],backgroundSize:\"cover\",backgroundPosition:\"center\"},paper:{margin:theme.spacing(8,4),display:\"flex\",flexDirection:\"column\",alignItems:\"center\"},avatar:{margin:theme.spacing(1),backgroundColor:theme.palette.secondary.main},form:{width:\"100%\",// Fix IE 11 issue.\nmarginTop:theme.spacing(1)},submit:{margin:theme.spacing(3,0,2)},modal:{outline:\"none\",position:\"absolute\",width:400,borderRadius:10,backgroundColor:\"white\",boxShadow:theme.shadows[5],padding:theme.spacing(10)}};});var Auth=function Auth(){var classes=useStyles();var dispatch=useDispatch();var signInGoogle=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return auth.signInWithPopup(provider).catch(function(err){return alert(err.message);});case 2:case\"end\":return _context.stop();}}},_callee);}));return function signInGoogle(){return _ref.apply(this,arguments);};}();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),isLogin=_useState6[0],setIsLogin=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),username=_useState8[0],setUsername=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),avatarImage=_useState10[0],setAvatarImage=_useState10[1];var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),openModal=_React$useState2[0],setOpenModal=_React$useState2[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),resetEmail=_useState12[0],setResetEmail=_useState12[1];var onChangeImageHandler=function onChangeImageHandler(e){if(e.target.files[0]){setAvatarImage(e.target.files[0]);e.target.value=\"\";}};var sendResetEmail=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return auth.sendPasswordResetEmail(resetEmail).then(function(){setOpenModal(false);setResetEmail(\"\");alert(\"パスワードの再設定用のメールを送信しました。\");}).catch(function(err){alert(err.message);setResetEmail(\"\");});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function sendResetEmail(_x){return _ref2.apply(this,arguments);};}();var signInEmail=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return auth.signInWithEmailAndPassword(email,password);case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function signInEmail(){return _ref3.apply(this,arguments);};}();var signUpEmail=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _authUser$user;var authUser,url,S,N,randomChar,fileName;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return auth.createUserWithEmailAndPassword(email,password);case 2:authUser=_context4.sent;url=\"\";if(!avatarImage){_context4.next=14;break;}S=\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";N=16;randomChar=Array.from(crypto.getRandomValues(new Uint32Array(N))).map(function(n){return S[n%S.length];}).join(\"\");fileName=randomChar+\"_\"+avatarImage.name;_context4.next=11;return storage.ref(\"avatars/\".concat(fileName)).put(avatarImage);case 11:_context4.next=13;return storage.ref(\"avatars\").child(fileName).getDownloadURL();case 13:url=_context4.sent;case 14:_context4.next=16;return(_authUser$user=authUser.user)===null||_authUser$user===void 0?void 0:_authUser$user.updateProfile({displayName:username,photoURL:url});case 16:dispatch(updateUserProfile({displayName:username,photoUrl:url}));case 17:case\"end\":return _context4.stop();}}},_callee4);}));return function signUpEmail(){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Grid,{container:true,component:\"main\",className:classes.root,children:[/*#__PURE__*/_jsx(CssBaseline,{}),/*#__PURE__*/_jsx(Grid,{item:true,xs:false,sm:4,md:7,className:classes.image}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:8,md:5,component:Paper,elevation:6,square:true,children:/*#__PURE__*/_jsxs(\"div\",{className:classes.paper,children:[/*#__PURE__*/_jsx(Avatar,{className:classes.avatar,children:/*#__PURE__*/_jsx(LockOutlinedIcon,{})}),/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h5\",children:\"Sign in\"}),/*#__PURE__*/_jsxs(\"form\",{className:classes.form,noValidate:true,children:[!isLogin&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",margin:\"normal\",required:true,fullWidth:true,id:\"username\",label:\"Username\",name:\"username\",autoComplete:\"username\",autoFocus:true,value:username,onChange:function onChange(e){setUsername(e.target.value);}}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",children:/*#__PURE__*/_jsx(IconButton,{children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(AccountCircleIcon,{fontSize:\"large\",className:avatarImage?styles.login_addIconLoaded:styles.login_addIcon}),/*#__PURE__*/_jsx(\"input\",{className:styles.login_hiddenIcon,type:\"file\",onChange:onChangeImageHandler})]})})})]}),/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",margin:\"normal\",required:true,fullWidth:true,id:\"email\",label:\"Email Address\",name:\"email\",autoComplete:\"email\",autoFocus:true,value:email,onChange:function onChange(e){setEmail(e.target.value);}}),/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",margin:\"normal\",required:true,fullWidth:true,name:\"password\",label:\"Password\",type:\"password\",id:\"password\",autoComplete:\"current-password\",value:password,onChange:function onChange(e){setPassword(e.target.value);}}),/*#__PURE__*/_jsx(Button,{disabled:isLogin?!email||password.length<6:!username||!email||password.length<6||!avatarImage,fullWidth:true,variant:\"contained\",color:\"primary\",className:classes.submit,startIcon:/*#__PURE__*/_jsx(EmailIcon,{}),onClick:isLogin?/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return signInEmail();case 3:_context5.next=8;break;case 5:_context5.prev=5;_context5.t0=_context5[\"catch\"](0);alert(_context5.t0.message);case 8:case\"end\":return _context5.stop();}}},_callee5,null,[[0,5]]);})):/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return signUpEmail();case 3:_context6.next=8;break;case 5:_context6.prev=5;_context6.t0=_context6[\"catch\"](0);alert(_context6.t0.message);case 8:case\"end\":return _context6.stop();}}},_callee6,null,[[0,5]]);})),children:isLogin?\"Login\":\"Register\"}),/*#__PURE__*/_jsxs(Grid,{container:true,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:true,children:/*#__PURE__*/_jsx(\"span\",{className:styles.login_reset,onClick:function onClick(){setOpenModal(true);},children:\"Forgot Password ?\"})}),/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(\"span\",{className:styles.login_toggleMode,onClick:function onClick(){return setIsLogin(!isLogin);},children:isLogin?\"Create new account ?\":\"Back to login\"})})]}),/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"contained\",color:\"primary\",startIcon:/*#__PURE__*/_jsx(CameraIcon,{}),className:classes.submit,onClick:signInGoogle,children:\"Sign In with Google\"})]}),/*#__PURE__*/_jsx(Modal,{open:openModal,onClose:function onClose(){return setOpenModal(false);},children:/*#__PURE__*/_jsx(\"div\",{style:getModalStyle(),className:classes.modal,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.login_modal,children:[/*#__PURE__*/_jsx(TextField,{InputLabelProps:{shrink:true},type:\"email\",name:\"email\",label:\"Reset E-mail\",value:resetEmail,onChange:function onChange(e){setResetEmail(e.target.value);}}),/*#__PURE__*/_jsx(IconButton,{onClick:sendResetEmail,children:/*#__PURE__*/_jsx(SendIcon,{})})]})})})]})})]});};export default Auth;","map":{"version":3,"sources":["/Users/kawashimakouta/Desktop/react-projects/twitter-app/src/components/Auth.tsx"],"names":["React","useState","styles","useDispatch","updateUserProfile","auth","provider","storage","Avatar","Button","CssBaseline","TextField","Paper","Grid","Typography","makeStyles","Modal","IconButton","Box","SendIcon","CameraIcon","EmailIcon","LockOutlinedIcon","AccountCircleIcon","getModalStyle","top","left","transform","useStyles","theme","root","height","image","backgroundImage","backgroundRepeat","backgroundColor","palette","type","grey","backgroundSize","backgroundPosition","paper","margin","spacing","display","flexDirection","alignItems","avatar","secondary","main","form","width","marginTop","submit","modal","outline","position","borderRadius","boxShadow","shadows","padding","Auth","classes","dispatch","signInGoogle","signInWithPopup","catch","err","alert","message","email","setEmail","password","setPassword","isLogin","setIsLogin","username","setUsername","avatarImage","setAvatarImage","openModal","setOpenModal","resetEmail","setResetEmail","onChangeImageHandler","e","target","files","value","sendResetEmail","sendPasswordResetEmail","then","signInEmail","signInWithEmailAndPassword","signUpEmail","createUserWithEmailAndPassword","authUser","url","S","N","randomChar","Array","from","crypto","getRandomValues","Uint32Array","map","n","length","join","fileName","name","ref","put","child","getDownloadURL","user","updateProfile","displayName","photoURL","photoUrl","login_addIconLoaded","login_addIcon","login_hiddenIcon","login_reset","login_toggleMode","login_modal","shrink"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport styles from \"./Auth.module.css\";\nimport { useDispatch } from \"react-redux\";\nimport { updateUserProfile } from \"../features/userSlice\";\nimport { auth, provider, storage } from \"../firebase/index\";\n\nimport {\n  Avatar,\n  Button,\n  CssBaseline,\n  TextField,\n  Paper,\n  Grid,\n  Typography,\n  makeStyles,\n  Modal,\n  IconButton,\n  Box\n} from \"@material-ui/core\";\n\nimport SendIcon from \"@material-ui/icons/Send\";\nimport CameraIcon from \"@material-ui/icons/Camera\";\nimport EmailIcon from \"@material-ui/icons/Email\";\nimport LockOutlinedIcon from \"@material-ui/icons/LockOutlined\";\nimport AccountCircleIcon from \"@material-ui/icons/AccountCircle\";\n\nfunction getModalStyle() {\n  const top = 50;\n  const left = 50;\n\n  return {\n    top: `${top}%`,\n    left: `${left}%`,\n    transform: `translate(-${top}%, -${left}%)`\n  };\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: \"100vh\"\n  },\n  image: {\n    backgroundImage:\n      \"url(https://images.unsplash.com/photo-1581784368651-8916092072cf?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=934&q=80)\",\n    backgroundRepeat: \"no-repeat\",\n    backgroundColor:\n      theme.palette.type === \"light\"\n        ? theme.palette.grey[50]\n        : theme.palette.grey[900],\n    backgroundSize: \"cover\",\n    backgroundPosition: \"center\"\n  },\n  paper: {\n    margin: theme.spacing(8, 4),\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\"\n  },\n  avatar: {\n    margin: theme.spacing(1),\n    backgroundColor: theme.palette.secondary.main\n  },\n  form: {\n    width: \"100%\", // Fix IE 11 issue.\n    marginTop: theme.spacing(1)\n  },\n  submit: {\n    margin: theme.spacing(3, 0, 2)\n  },\n  modal: {\n    outline: \"none\",\n    position: \"absolute\",\n    width: 400,\n    borderRadius: 10,\n    backgroundColor: \"white\",\n    boxShadow: theme.shadows[5],\n    padding: theme.spacing(10),\n  },\n}));\n\nconst Auth: React.FC = () => {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const signInGoogle = async () => {\n    await auth.signInWithPopup(provider).catch(err => alert(err.message));\n  };\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [isLogin, setIsLogin] = useState(true);\n  const [username, setUsername] = useState(\"\");\n  const [avatarImage, setAvatarImage] = useState<File | null>(null);\n  const [openModal, setOpenModal] = React.useState(false);\n  const [resetEmail, setResetEmail] = useState(\"\");\n\n  const onChangeImageHandler = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files![0]) {\n      setAvatarImage(e.target.files![0]);\n      e.target.value = \"\";\n    }\n  };\n\n  const sendResetEmail = async (e: React.MouseEvent<HTMLElement>) => {\n    await auth\n      .sendPasswordResetEmail(resetEmail)\n      .then(() => {\n        setOpenModal(false);\n        setResetEmail(\"\");\n        alert(\"パスワードの再設定用のメールを送信しました。\")\n      })\n      .catch(err => {\n        alert(err.message);\n        setResetEmail(\"\");\n      });\n  };\n\n  const signInEmail = async () => {\n    await auth.signInWithEmailAndPassword(email, password);\n  };\n  const signUpEmail = async () => {\n    const authUser = await auth.createUserWithEmailAndPassword(email, password);\n    let url = \"\";\n    if (avatarImage) {\n      const S =\n        \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n      const N = 16;\n      const randomChar = Array.from(crypto.getRandomValues(new Uint32Array(N)))\n        .map(n => S[n % S.length])\n        .join(\"\");\n      const fileName = randomChar + \"_\" + avatarImage.name;\n      await storage.ref(`avatars/${fileName}`).put(avatarImage);\n      url = await storage\n        .ref(\"avatars\")\n        .child(fileName)\n        .getDownloadURL();\n    }\n    await authUser.user?.updateProfile({\n      displayName: username,\n      photoURL: url\n    });\n    dispatch(\n      updateUserProfile({\n        displayName: username,\n        photoUrl: url\n      })\n    );\n  };\n\n  return (\n    <Grid container component=\"main\" className={classes.root}>\n      <CssBaseline />\n      <Grid item xs={false} sm={4} md={7} className={classes.image} />\n      <Grid item xs={12} sm={8} md={5} component={Paper} elevation={6} square>\n        <div className={classes.paper}>\n          <Avatar className={classes.avatar}>\n            <LockOutlinedIcon />\n          </Avatar>\n          <Typography component=\"h1\" variant=\"h5\">\n            Sign in\n          </Typography>\n          <form className={classes.form} noValidate>\n            {!isLogin && (\n              <>\n                <TextField\n                  variant=\"outlined\"\n                  margin=\"normal\"\n                  required\n                  fullWidth\n                  id=\"username\"\n                  label=\"Username\"\n                  name=\"username\"\n                  autoComplete=\"username\"\n                  autoFocus\n                  value={username}\n                  onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                    setUsername(e.target.value);\n                  }}\n                />\n                <Box textAlign=\"center\">\n                  <IconButton>\n                    <label>\n                      <AccountCircleIcon\n                        fontSize=\"large\"\n                        className={\n                          avatarImage\n                            ? styles.login_addIconLoaded\n                            : styles.login_addIcon\n                        }\n                      />\n                      <input\n                        className={styles.login_hiddenIcon}\n                        type=\"file\"\n                        onChange={onChangeImageHandler}\n                      />\n                    </label>\n                  </IconButton>\n                </Box>\n              </>\n            )}\n            <TextField\n              variant=\"outlined\"\n              margin=\"normal\"\n              required\n              fullWidth\n              id=\"email\"\n              label=\"Email Address\"\n              name=\"email\"\n              autoComplete=\"email\"\n              autoFocus\n              value={email}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                setEmail(e.target.value);\n              }}\n            />\n\n            <TextField\n              variant=\"outlined\"\n              margin=\"normal\"\n              required\n              fullWidth\n              name=\"password\"\n              label=\"Password\"\n              type=\"password\"\n              id=\"password\"\n              autoComplete=\"current-password\"\n              value={password}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                setPassword(e.target.value);\n              }}\n            />\n            <Button\n              disabled={\n                isLogin\n                  ? !email || password.length < 6\n                  : !username || !email || password.length < 6 || !avatarImage\n              }\n              fullWidth\n              variant=\"contained\"\n              color=\"primary\"\n              className={classes.submit}\n              startIcon={<EmailIcon />}\n              onClick={\n                isLogin\n                  ? async () => {\n                      try {\n                        await signInEmail();\n                      } catch (err) {\n                        alert(err.message);\n                      }\n                    }\n                  : async () => {\n                      try {\n                        await signUpEmail();\n                      } catch (err) {\n                        alert(err.message);\n                      }\n                    }\n              }\n            >\n              {isLogin ? \"Login\" : \"Register\"}\n            </Button>\n            <Grid container>\n              <Grid item xs>\n                <span\n                  className={styles.login_reset}\n                  onClick={() => {\n                    setOpenModal(true);\n                  }}\n                >\n                  Forgot Password ?\n                </span>\n              </Grid>\n              <Grid item>\n                <span\n                  className={styles.login_toggleMode}\n                  onClick={() => setIsLogin(!isLogin)}\n                >\n                  {isLogin ? \"Create new account ?\" : \"Back to login\"}\n                </span>\n              </Grid>\n            </Grid>\n            <Button\n              fullWidth\n              variant=\"contained\"\n              color=\"primary\"\n              startIcon={<CameraIcon />}\n              className={classes.submit}\n              onClick={signInGoogle}\n            >\n              Sign In with Google\n            </Button>\n          </form>\n\n          <Modal open={openModal} onClose={() => setOpenModal(false)}>\n            <div style={getModalStyle()} className={classes.modal}>\n              <div className={styles.login_modal}>\n                <TextField\n                  InputLabelProps={{\n                    shrink: true,\n                  }}\n                  type=\"email\"\n                  name=\"email\"\n                  label=\"Reset E-mail\"\n                  value={resetEmail}\n                  onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n                    setResetEmail(e.target.value);\n                  }}\n                />\n                <IconButton onClick={\n                  sendResetEmail\n                }>\n                  <SendIcon />\n                </IconButton>\n              </div>\n            </div>\n          </Modal>\n\n        </div>\n      </Grid>\n    </Grid>\n  );\n};\n\nexport default Auth;\n"]},"metadata":{},"sourceType":"module"}