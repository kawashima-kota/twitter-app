{"ast":null,"code":"import _regeneratorRuntime from\"/Users/kawashimakouta/Desktop/react-projects/twitter-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/kawashimakouta/Desktop/react-projects/twitter-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/kawashimakouta/Desktop/react-projects/twitter-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import styles from\"./TweetInput.module.css\";import{useSelector}from\"react-redux\";import{selectUser}from\"../features/userSlice\";import{auth,storage,db}from\"../firebase/index\";import{Avatar,Button,IconButton}from\"@material-ui/core\";import firebase from\"firebase/app\";import AddAPhotoIcon from\"@material-ui/icons/AddAPhoto\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var TweetInput=function TweetInput(){var user=useSelector(selectUser);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),tweetImage=_useState2[0],setTweetImage=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),tweetMsg=_useState4[0],setTweetMsg=_useState4[1];var onChangeImageHandler=function onChangeImageHandler(e){if(e.target.files[0]){setTweetImage(e.target.files[0]);e.target.value=\"\";}};var sendTweet=function sendTweet(e){e.preventDefault();if(tweetImage){var S=\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";var N=16;var randomChar=Array.from(crypto.getRandomValues(new Uint32Array(N))).map(function(n){return S[n%S.length];}).join(\"\");var fileName=randomChar+\"_\"+tweetImage.name;var uploadTweetImg=storage.ref(\"images/\".concat(fileName)).put(tweetImage);uploadTweetImg.on(firebase.storage.TaskEvent.STATE_CHANGED,//進捗\nfunction(){},//エラー処理\nfunction(err){alert(err.message);},/*#__PURE__*/ //正常終了時\n_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return storage.ref(\"images\").child(fileName).getDownloadURL().then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(url){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return db.collection(\"posts\").add({avatar:user.photoUrl,image:url,text:tweetMsg,timestamp:firebase.firestore.FieldValue.serverTimestamp(),username:user.displayName});case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());case 2:case\"end\":return _context2.stop();}}},_callee2);})));}else{db.collection(\"posts\").add({avatar:user.photoUrl,image:\"\",text:tweetMsg,timestamp:firebase.firestore.FieldValue.serverTimestamp(),username:user.displayName});}setTweetImage(null);setTweetMsg(\"\");};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:sendTweet,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.tweet_form,children:[/*#__PURE__*/_jsx(Avatar,{className:styles.tweet_avatar,src:user.photoUrl,onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return auth.signOut();case 2:case\"end\":return _context3.stop();}}},_callee3);}))}),/*#__PURE__*/_jsx(\"input\",{className:styles.tweet_input,placeholder:\"What's happening?\",type:\"text\",autoFocus:true,value:tweetMsg,onChange:function onChange(e){return setTweetMsg(e.target.value);}}),/*#__PURE__*/_jsx(IconButton,{children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(AddAPhotoIcon,{className:tweetImage?styles.tweet_addIconLoaded:styles.tweet_addIcon}),/*#__PURE__*/_jsx(\"input\",{className:styles.tweet_hiddenIcon,type:\"file\",onChange:onChangeImageHandler})]})})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:!tweetMsg,className:tweetMsg?styles.tweet_sendBtn:styles.tweet_sendDisableBtn,children:\"Tweet\"})]})});};export default TweetInput;","map":{"version":3,"sources":["/Users/kawashimakouta/Desktop/react-projects/twitter-app/src/components/TweetInput.tsx"],"names":["React","useState","styles","useSelector","selectUser","auth","storage","db","Avatar","Button","IconButton","firebase","AddAPhotoIcon","TweetInput","user","tweetImage","setTweetImage","tweetMsg","setTweetMsg","onChangeImageHandler","e","target","files","value","sendTweet","preventDefault","S","N","randomChar","Array","from","crypto","getRandomValues","Uint32Array","map","n","length","join","fileName","name","uploadTweetImg","ref","put","on","TaskEvent","STATE_CHANGED","err","alert","message","child","getDownloadURL","then","url","collection","add","avatar","photoUrl","image","text","timestamp","firestore","FieldValue","serverTimestamp","username","displayName","tweet_form","tweet_avatar","signOut","tweet_input","tweet_addIconLoaded","tweet_addIcon","tweet_hiddenIcon","tweet_sendBtn","tweet_sendDisableBtn"],"mappings":"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","sourcesContent":["import React ,{useState} from 'react'\nimport styles from \"./TweetInput.module.css\";\nimport { useSelector } from \"react-redux\";\nimport { selectUser } from \"../features/userSlice\";\nimport {auth,storage,db} from \"../firebase/index\"\nimport { Avatar, Button, IconButton } from \"@material-ui/core\";\nimport firebase from \"firebase/app\"\nimport AddAPhotoIcon from \"@material-ui/icons/AddAPhoto\";\n\nconst TweetInput:React.FC = () => {\n  const user = useSelector(selectUser);\n  const [tweetImage, setTweetImage] = useState<File | null>(null);\n  const [tweetMsg, setTweetMsg] = useState(\"\");\n  const onChangeImageHandler = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files![0]) {\n      setTweetImage(e.target.files![0]);\n      e.target.value = \"\";\n    }\n  };\n  const sendTweet = (e:React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    if(tweetImage){\n      const S =\n        \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n      const N = 16;\n      const randomChar = Array.from(crypto.getRandomValues(new Uint32Array(N)))\n        .map((n) => S[n % S.length])\n        .join(\"\");\n      const fileName = randomChar + \"_\" + tweetImage.name;\n      const uploadTweetImg = storage.ref(`images/${fileName}`).put(tweetImage);\n      uploadTweetImg.on(\n        firebase.storage.TaskEvent.STATE_CHANGED,\n        //進捗\n        () => {},\n        //エラー処理\n        (err) => {\n          alert(err.message);\n        },\n        //正常終了時\n        async () => {\n          //storageからユーザーの画像を取得してデータをデータベースに格納\n          await storage\n            .ref(\"images\")\n            .child(fileName)\n            .getDownloadURL()\n            .then(async (url) => {\n              await db.collection(\"posts\").add({\n                avatar: user.photoUrl,\n                image: url,\n                text: tweetMsg,\n                timestamp: firebase.firestore.FieldValue.serverTimestamp(),\n                username: user.displayName,\n              });\n            });\n        }\n      );\n    }else{\n      db.collection(\"posts\").add({\n        avatar: user.photoUrl,\n        image:\"\",\n        text:tweetMsg,\n        timestamp: firebase.firestore.FieldValue.serverTimestamp(),\n        username: user.displayName,\n      })\n    }\n    setTweetImage(null);\n    setTweetMsg(\"\");\n  }\n\n  return (\n    <>\n      <form onSubmit={sendTweet}>\n        <div className={styles.tweet_form}>\n          <Avatar\n              className={styles.tweet_avatar}\n              src={user.photoUrl}\n              onClick={async () => {\n                await auth.signOut();\n              }}\n            />\n          <input\n            className={styles.tweet_input}\n            placeholder=\"What's happening?\"\n            type=\"text\"\n            autoFocus\n            value={tweetMsg}\n            onChange={(e) => setTweetMsg(e.target.value)}\n          />\n          <IconButton>\n            <label>\n              <AddAPhotoIcon\n                className={\n                  tweetImage ? styles.tweet_addIconLoaded : styles.tweet_addIcon\n                }\n              />\n              <input\n                className={styles.tweet_hiddenIcon}\n                type=\"file\"\n                onChange={onChangeImageHandler}\n              />\n            </label>\n          </IconButton>\n        </div>\n        <Button\n          type=\"submit\"\n          disabled={!tweetMsg}\n          className={\n            tweetMsg ? styles.tweet_sendBtn : styles.tweet_sendDisableBtn\n          }\n        >\n          Tweet\n        </Button>\n      </form>\n    </>\n  )\n}\n\nexport default TweetInput\n"]},"metadata":{},"sourceType":"module"}