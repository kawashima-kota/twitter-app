{"ast":null,"code":"import _slicedToArray from\"/Users/kawashimakouta/Desktop/react-projects/twitter-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import styles from\"./Post.module.css\";import{db}from\"../firebase/index\";import firebase from\"firebase/app\";import{useSelector}from\"react-redux\";import{selectUser}from\"../features/userSlice\";import{Avatar}from\"@material-ui/core\";import{makeStyles}from\"@material-ui/core/styles\";import MessageIcon from\"@material-ui/icons/Message\";import SendIcon from\"@material-ui/icons/Send\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{small:{width:theme.spacing(3),height:theme.spacing(3),marginRight:theme.spacing(1)}};});var Post=function Post(props){var _props$timestamp;var classes=useStyles();var user=useSelector(selectUser);//投稿に対するコメントを管理するstate\nvar _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),comment=_useState2[0],setComment=_useState2[1];//表示させるコメントを管理するstate\nvar _useState3=useState([{id:\"\",avatar:\"\",text:\"\",timestamp:null,username:\"\"}]),_useState4=_slicedToArray(_useState3,2),comments=_useState4[0],setComments=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),openComments=_useState6[0],setOpenComments=_useState6[1];//表示するコメントをfirestoreから取得\nuseEffect(function(){var unSub=db.collection(\"posts\").doc(props.postId).collection(\"comments\")//投稿日時の順で取得する\n.orderBy(\"timestamp\",\"desc\").onSnapshot(function(snapshot){setComments(//フィールドの属性へのアクセスにはdata()を挟む\nsnapshot.docs.map(function(doc){return{id:doc.id,avatar:doc.data().avatar,text:doc.data().text,username:doc.data().username,timestamp:doc.data().timestamp};}));});return function(){unSub();};},[props.postId]);var newComment=function newComment(e){e.preventDefault();db.collection(\"posts\").doc(props.postId).collection(\"comments\").add({avatar:user.photoUrl,text:comment,timestamp:firebase.firestore.FieldValue.serverTimestamp(),username:user.displayName});setComment(\"\");};return/*#__PURE__*/_jsxs(\"div\",{className:styles.post,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.post_avatar,children:/*#__PURE__*/_jsx(Avatar,{src:props.avatar})}),/*#__PURE__*/_jsxs(\"div\",{className:styles.post_body,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:styles.post_header,children:/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsxs(\"span\",{className:styles.post_headerUser,children:[\"@\",props.username]}),/*#__PURE__*/_jsx(\"span\",{className:styles.post_headerTime,children:new Date((_props$timestamp=props.timestamp)===null||_props$timestamp===void 0?void 0:_props$timestamp.toDate()).toLocaleString()})]})}),/*#__PURE__*/_jsx(\"div\",{className:styles.post_tweet,children:/*#__PURE__*/_jsx(\"p\",{children:props.text})})]}),props.image&&/*#__PURE__*/_jsx(\"div\",{className:styles.post_tweetImage,children:/*#__PURE__*/_jsx(\"img\",{src:props.image,alt:\"tweet\"})}),/*#__PURE__*/_jsx(MessageIcon,{className:styles.post_commentIcon,onClick:function onClick(){return setOpenComments(!openComments);}}),openComments&&/*#__PURE__*/_jsxs(_Fragment,{children:[comments.map(function(com){var _com$timestamp;return/*#__PURE__*/_jsxs(\"div\",{className:styles.post_comment,children:[/*#__PURE__*/_jsx(Avatar,{src:com.avatar,className:classes.small}),/*#__PURE__*/_jsxs(\"span\",{className:styles.post_commentUser,children:[\"@\",com.username]}),/*#__PURE__*/_jsxs(\"span\",{className:styles.post_commentText,children:[com.text,\" \"]}),/*#__PURE__*/_jsx(\"span\",{className:styles.post_headerTime,children:new Date((_com$timestamp=com.timestamp)===null||_com$timestamp===void 0?void 0:_com$timestamp.toDate()).toLocaleString()})]},com.id);}),/*#__PURE__*/_jsx(\"form\",{onSubmit:newComment,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.post_input,children:[/*#__PURE__*/_jsx(\"input\",{className:styles.post_input,type:\"text\",placeholder:\"Type new comment...\",value:comment,onChange:function onChange(e){return setComment(e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{disabled:!comment,className:comment?styles.post_button:styles.post_buttonDisable,type:\"submit\",children:/*#__PURE__*/_jsx(SendIcon,{className:styles.post_sendIcon})})]})})]})]})]});};export default Post;","map":{"version":3,"sources":["/Users/kawashimakouta/Desktop/react-projects/twitter-app/src/components/Post.tsx"],"names":["React","useState","useEffect","styles","db","firebase","useSelector","selectUser","Avatar","makeStyles","MessageIcon","SendIcon","useStyles","theme","small","width","spacing","height","marginRight","Post","props","classes","user","comment","setComment","id","avatar","text","timestamp","username","comments","setComments","openComments","setOpenComments","unSub","collection","doc","postId","orderBy","onSnapshot","snapshot","docs","map","data","newComment","e","preventDefault","add","photoUrl","firestore","FieldValue","serverTimestamp","displayName","post","post_avatar","post_body","post_header","post_headerUser","post_headerTime","Date","toDate","toLocaleString","post_tweet","image","post_tweetImage","post_commentIcon","com","post_comment","post_commentUser","post_commentText","post_input","target","value","post_button","post_buttonDisable","post_sendIcon"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport styles from \"./Post.module.css\";\nimport { db } from \"../firebase/index\";\nimport firebase from \"firebase/app\";\nimport { useSelector } from \"react-redux\";\nimport { selectUser } from \"../features/userSlice\";\nimport { Avatar } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport MessageIcon from \"@material-ui/icons/Message\";\nimport SendIcon from \"@material-ui/icons/Send\";\n\ninterface PROPS {\n  postId: string;\n  avatar: string;\n  image: string;\n  text: string;\n  timestamp: any;\n  username: string;\n}\n\ninterface COMMENT {\n  id: string;\n  avatar: string;\n  text: string;\n  timestamp: any;\n  username: string;\n}\n\nconst useStyles = makeStyles((theme) => ({\n  small: {\n    width: theme.spacing(3),\n    height: theme.spacing(3),\n    marginRight: theme.spacing(1),\n  },\n}));\n\nconst Post: React.FC<PROPS> = props => {\n  const classes = useStyles();\n  const user = useSelector(selectUser);\n  //投稿に対するコメントを管理するstate\n  const [comment, setComment] = useState(\"\");\n  //表示させるコメントを管理するstate\n  const [comments, setComments] = useState<COMMENT[]>([\n    {\n      id:\"\",\n      avatar: \"\",\n      text: \"\",\n      timestamp: null,\n      username: \"\"\n    }\n  ])\n  const [openComments, setOpenComments] = useState(false);\n\n  //表示するコメントをfirestoreから取得\n  useEffect(() => {\n    const unSub = db\n      .collection(\"posts\")\n      .doc(props.postId)\n      .collection(\"comments\")\n      //投稿日時の順で取得する\n      .orderBy(\"timestamp\", \"desc\")\n      .onSnapshot((snapshot) => {\n        setComments(\n          //フィールドの属性へのアクセスにはdata()を挟む\n          snapshot.docs.map((doc) => ({\n            id: doc.id,\n            avatar: doc.data().avatar,\n            text: doc.data().text,\n            username: doc.data().username,\n            timestamp: doc.data().timestamp,\n          }))\n        );\n      });\n\n    return () => {\n      unSub();\n    };\n  }, [props.postId]);\n\n  const newComment = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    db.collection(\"posts\")\n      .doc(props.postId)\n      .collection(\"comments\")\n      .add({\n        avatar: user.photoUrl,\n        text: comment,\n        timestamp: firebase.firestore.FieldValue.serverTimestamp(),\n        username: user.displayName\n      });\n    setComment(\"\");\n  };\n\n  return (\n    <div className={styles.post}>\n      <div className={styles.post_avatar}>\n        <Avatar src={props.avatar} />\n      </div>\n      <div className={styles.post_body}>\n        <div>\n          <div className={styles.post_header}>\n            <h3>\n              <span className={styles.post_headerUser}>@{props.username}</span>\n              <span className={styles.post_headerTime}>\n                {new Date(props.timestamp?.toDate()).toLocaleString()}\n              </span>\n            </h3>\n          </div>\n          <div className={styles.post_tweet}>\n            <p>{props.text}</p>\n          </div>\n        </div>\n        {props.image && (\n          <div className={styles.post_tweetImage}>\n            <img src={props.image} alt=\"tweet\" />\n          </div>\n        )}\n\n        <MessageIcon\n          className={styles.post_commentIcon}\n          onClick={() => setOpenComments(!openComments)}\n        />\n\n        { openComments &&  (\n          <>\n            {comments.map((com) => (\n            <div key={com.id} className={styles.post_comment}>\n              <Avatar src={com.avatar} className={classes.small} />\n\n              <span className={styles.post_commentUser}>@{com.username}</span>\n              <span className={styles.post_commentText}>{com.text} </span>\n              <span className={styles.post_headerTime}>\n                {new Date(com.timestamp?.toDate()).toLocaleString()}\n              </span>\n            </div>\n          ))}\n\n          <form onSubmit={newComment}>\n            <div className={styles.post_input}>\n              <input\n                className={styles.post_input}\n                type=\"text\"\n                placeholder=\"Type new comment...\"\n                value={comment}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  setComment(e.target.value)\n                }\n              />\n              <button\n                disabled={!comment}\n                className={\n                  comment ? styles.post_button : styles.post_buttonDisable\n                }\n                type=\"submit\"\n              >\n                <SendIcon className={styles.post_sendIcon} />\n              </button>\n            </div>\n          </form>\n        </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Post;\n"]},"metadata":{},"sourceType":"module"}